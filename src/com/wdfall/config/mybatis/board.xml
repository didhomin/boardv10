<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wdfall.dao.BoardDao">
    <select id="list" parameterType="java.util.Map" resultType="boardDto">
        SELECT b.*
        FROM (
        	SELECT rownum rn, a.*
        	FROM (
        		SELECT b.board_seq boardSeq ,
        		       b.subject ,
        		       b.insertdate insertDate ,
        		       b.updatedate updatedate ,
        		       b.hit hit,
        		       b.secret secret,
        		       b.recommend recommend,
        		       m.id id
        		FROM board b,member m
        		WHERE b.member_seq=m.member_seq
        		ORDER BY board_seq DESC
        		) a
        		WHERE rownum &lt;=#{end}
        	) b
        	WHERE b.rn&gt;#{start}
    </select>
    
    <insert id="write" parameterType="boardDto">
        INSERT INTO
        board (board_seq,member_seq,subject,content,insertDate,updateDate,
                hit,secret,recommend)
        VALUES (seq_board.nextval,#{memberSeq},#{subject},#{content},sysdate,sysdate,
                0,#{secret},0)
    </insert>
    
    <select id="view" parameterType="String" resultType="boardDto">
        SELECT b.board_seq boardSeq ,
                b.subject ,
                b.content ,
                b.insertdate insertDate ,
                b.updatedate updatedate ,
                b.hit hit,
                b.secret secret,
                b.recommend recommend,
                m.id id
        FROM board b,member m
        WHERE b.member_seq=m.member_seq
        AND b.board_seq=#{boardSeq}
    </select>
    
    <delete id="delete" parameterType="String">
        DELETE 
        FROM board
        WHERE board_seq=#{boardSeq}
    </delete>
    
    <update id="modify" parameterType="boardDto">
        UPDATE board
        SET	subject=#{subject} , 
            content=#{content} , 
            updatedate=sysdate,
        <choose>
            <when test="secret==1">
                secret=1
            </when>
            <otherwise>
                secret=0
            </otherwise>
        </choose>
        WHERE board_seq=#{boardSeq}
    </update>
    <update id="hit" parameterType="String">
        UPDATE board
        SET	hit=hit+1
        WHERE board_seq=#{boardSeq}
    </update>
    <update id="recommendCount" parameterType="String">
        UPDATE board
        SET	recommend=recommend+1
        WHERE board_seq=#{boardSeq}
    </update>
    <insert id="recommend" parameterType="boardDto">
        INSERT INTO
        recommend (recommend_seq,member_seq,board_seq)
        VALUES (seq_recommend.nextval,#{memberSeq},#{boardSeq})
    </insert>
    <select id="isRecommend" resultType="int" parameterType="boardDto">
        SELECT count(*)
        FROM recommend
        WHERE member_seq=#{memberSeq} 
        AND board_seq=#{boardSeq}
    </select>
    
</mapper>